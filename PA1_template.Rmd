---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

## Loading and preprocessing the data

```{r setup, echo=TRUE}
# Load required libraries
library(ggplot2)
library(dplyr)

# Set global options
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_data, echo=TRUE}
# Download and load the data if it doesn't exist
if (!file.exists("activity.csv")) {
    cat("Downloading activity data...\n")
    download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip", 
                  "activity.zip", method = "auto")
    unzip("activity.zip")
    file.remove("activity.zip")
    cat("Download complete!\n")
}

# Load the data
activity_data <- read.csv("activity.csv", header = TRUE)

# Process/transform the data
activity_data$date <- as.Date(activity_data$date)

# Display basic information about the dataset
str(activity_data)
head(activity_data)
summary(activity_data)
```

## What is mean total number of steps taken per day?

For this part of the assignment, missing values in the dataset are ignored.

```{r steps_per_day, echo=TRUE}
# Calculate the total number of steps taken per day
daily_steps <- aggregate(steps ~ date, activity_data, sum, na.rm = TRUE)

# Make a histogram of the total number of steps taken each day
hist(daily_steps$steps, 
     breaks = 20,
     main = "Histogram of Total Number of Steps Taken Each Day",
     xlab = "Total Steps per Day",
     ylab = "Frequency",
     col = "skyblue",
     border = "black")

# Calculate and report the mean and median
mean_steps <- mean(daily_steps$steps, na.rm = TRUE)
median_steps <- median(daily_steps$steps, na.rm = TRUE)

cat("Mean total number of steps taken per day:", round(mean_steps, 2), "\n")
cat("Median total number of steps taken per day:", median_steps, "\n")
```

The mean total number of steps taken per day is **10,766.19** and the median is **10,765**.

## What is the average daily activity pattern?

```{r daily_pattern, echo=TRUE}
# Calculate average number of steps for each 5-minute interval
interval_avg <- aggregate(steps ~ interval, activity_data, mean, na.rm = TRUE)

# Make a time series plot
plot(interval_avg$interval, interval_avg$steps,
     type = "l",
     main = "Average Daily Activity Pattern",
     xlab = "5-minute Interval",
     ylab = "Average Number of Steps",
     col = "blue",
     lwd = 2)

# Find the interval with maximum number of steps
max_interval <- interval_avg$interval[which.max(interval_avg$steps)]
max_steps <- max(interval_avg$steps)

cat("The 5-minute interval with the maximum average number of steps is:", max_interval, "\n")
cat("Maximum average steps:", round(max_steps, 2), "\n")
```

The **835** interval (8:35 AM) contains the maximum number of steps on average across all days, with **206.17** steps.

## Imputing missing values

```{r missing_values, echo=TRUE}
# Calculate total number of missing values
total_nas <- sum(is.na(activity_data$steps))
cat("Total number of missing values in the dataset:", total_nas, "\n")

# Strategy: Use the mean for that 5-minute interval to fill missing values
# Create a new dataset with filled-in missing values
activity_filled <- activity_data

for (i in 1:nrow(activity_filled)) {
    if (is.na(activity_filled$steps[i])) {
        interval_value <- activity_filled$interval[i]
        activity_filled$steps[i] <- interval_avg$steps[interval_avg$interval == interval_value]
    }
}

# Verify no missing values remain
cat("Missing values after imputation:", sum(is.na(activity_filled$steps)), "\n")

# Calculate new daily totals
daily_steps_filled <- aggregate(steps ~ date, activity_filled, sum)

# Make histogram of imputed data
hist(daily_steps_filled$steps, 
     breaks = 20,
     main = "Histogram of Total Steps per Day (After Imputation)",
     xlab = "Total Steps per Day",
     ylab = "Frequency",
     col = "lightgreen",
     border = "black")

# Calculate new mean and median
mean_steps_filled <- mean(daily_steps_filled$steps)
median_steps_filled <- median(daily_steps_filled$steps)

cat("Mean total steps per day (after imputation):", round(mean_steps_filled, 2), "\n")
cat("Median total steps per day (after imputation):", round(median_steps_filled, 2), "\n")

# Compare with original values
cat("\nComparison:\n")
cat("Original mean:", round(mean_steps, 2), "vs Imputed mean:", round(mean_steps_filled, 2), "\n")
cat("Original median:", median_steps, "vs Imputed median:", round(median_steps_filled, 2), "\n")
```

**Strategy for imputing missing values:** Missing values were replaced with the mean number of steps for the corresponding 5-minute interval across all days.

**Impact of imputing missing data:** 
- The mean remained the same at 10,766.19 steps per day
- The median increased slightly from 10,765 to 10,766.19 steps per day
- By using interval means for imputation, we maintained the overall daily activity patterns while filling in missing data

## Are there differences in activity patterns between weekdays and weekends?

```{r weekday_weekend, echo=TRUE}
# Create a new factor variable for weekday/weekend
activity_filled$day_type <- ifelse(weekdays(activity_filled$date) %in% c("Saturday", "Sunday"), 
                                  "weekend", "weekday")
activity_filled$day_type <- as.factor(activity_filled$day_type)

# Calculate average steps by interval and day type
interval_day_avg <- aggregate(steps ~ interval + day_type, activity_filled, mean)

# Create panel plot using base plotting system
par(mfrow = c(2, 1), mar = c(4, 4, 2, 1))

# Weekday plot
weekday_data <- interval_day_avg[interval_day_avg$day_type == "weekday", ]
plot(weekday_data$interval, weekday_data$steps,
     type = "l",
     main = "weekday",
     xlab = "",
     ylab = "Number of steps",
     col = "blue",
     lwd = 2)

# Weekend plot
weekend_data <- interval_day_avg[interval_day_avg$day_type == "weekend", ]
plot(weekend_data$interval, weekend_data$steps,
     type = "l",
     main = "weekend",
     xlab = "Interval",
     ylab = "Number of steps",
     col = "blue",
     lwd = 2)

# Reset plotting parameters
par(mfrow = c(1, 1))

# Summary statistics by day type
weekday_avg <- mean(activity_filled$steps[activity_filled$day_type == "weekday"])
weekend_avg <- mean(activity_filled$steps[activity_filled$day_type == "weekend"])

cat("Average steps on weekdays:", round(weekday_avg, 2), "\n")
cat("Average steps on weekends:", round(weekend_avg, 2), "\n")
```

**Differences between weekdays and weekends:**

1. **Weekdays** show a sharp peak in activity around 8:35 AM (likely commuting to work), followed by relatively lower activity during work hours (average: 35.61 steps per interval).

2. **Weekends** show more distributed activity throughout the day, with less pronounced morning peak but generally higher overall activity levels (average: 42.37 steps per interval).

3. Weekend activity patterns suggest more leisurely, sustained activity throughout the day compared to the concentrated morning activity on weekdays.

## Summary

This analysis of personal activity monitoring data reveals several key insights:

- The individual averaged **10,766 steps per day** over the two-month period
- Peak activity consistently occurs around **8:35 AM** with an average of **206 steps**
- **Weekend activity** is more evenly distributed and averages **19% higher** than weekdays
- The imputation strategy using interval means successfully filled **2,304 missing values** while preserving the underlying activity patterns
- Clear behavioral differences exist between weekday and weekend activity patterns, reflecting typical work-week vs. leisure-time behaviors